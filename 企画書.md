# Python関数要件定義書：社員ペアリング生成

## 1\. 目的・概要

社員情報とチーム情報が含まれる2つのCSVファイルを入力とし、指定された条件を満たすように、全対象者を重複なく2人1組のペアに分ける。そのペアの組み合わせの1パターンを生成して返す。

## 2\. 関数名

`generate_complete_pairing`

## 3\. 入力 (引数)

本関数は以下の引数を受け取る。

| 引数名 | 型 | 必須/任意 | 説明 |
| :--- | :--- | :--- | :--- |
| `employee_info_csv` | `str` | 必須 | 社員の「名前」と「グループ」情報を含むCSVファイルのパス。 |
| `team_info_csv` | `str` | 必須 | 社員の「名前」と「チーム」情報を含むCSVファイルのパス。 |
| `exclusion_list` | `List[str]` | 任意 | ペアリングから除外する社員名のリスト。デフォルトは空のリスト `[]`。 |

### CSVファイルの仕様

  - **`employee_info_csv`**:
      - 文字コード: UTF-8
      - 必須カラム: `名前`, `グループ`
  - **`team_info_csv`**:
      - 文字コード: UTF-8
      - 必須カラム: `名前`, `チーム`

## 4\. 処理内容

関数は以下のステップで処理を実行する。

1.  **データ読み込みと統合**

      - `pandas`ライブラリを使用し、引数で指定された2つのCSVファイルを読み込む。
      - 2つのテーブルを`名前`カラムをキーとして内部結合し、各社員の「名前」「グループ」「チーム」を紐付けた単一のデータテーブルを作成する。

2.  **データの前処理**

      - `exclusion_list` に含まれる社員をデータテーブルから除外する。
      - 処理対象の総人数をチェックし、奇数の場合はペアを作成できないため、例外 (`ValueError`) を発生させる。

3.  **ペアリングアルゴリズム（ランダム化・発見的探索）**

      - 条件を満たすペアの組み合わせが見つかるまで、または規定の試行回数に達するまで、以下の探索処理を繰り返す。
        1.  **初期化**: 対象社員のリストをランダムにシャッフルする。ペアが成立した社員を記録するセットと、結果を格納するペアリストを空の状態で準備する。
        2.  **ペア探索**: シャッフルしたリストの先頭から順に社員（`p1`）を選択する。
        3.  `p1`がまだペアになっていない場合、残りの未ペア社員の中から、以下の**ペアリング条件**をすべて満たす候補者（`p2`）を探す。
              - `p1` のグループと `p2` のグループが異なる。
              - `p1` のチームと `p2` のチームが異なる。
        4.  **ペア決定**:
              - 候補者が一人以上いる場合、その中からランダムに一人を`p2`として選び、`(p1, p2)`のペアを成立させる。成立したペアを結果リストに追加し、`p1`と`p2`を「ペア成立済み」として記録する。
              - 候補者が一人もいない場合、この試行は失敗とみなし、探索を中断して `3-1` のシャッフルからやり直す。
        5.  **成功判定**: 全員がペアになれた場合、探索は成功。生成したペアリストを戻り値として返し、関数を終了する。

4.  **失敗時の処理**

      - 規定の試行回数（例: 1000回）を超えても成功しなかった場合、組み合わせを見つけられなかったと判断し、`None`を返す。

## 5\. 出力 (戻り値)

| 条件 | 型 | 説明 |
| :--- | :--- | :--- |
| **成功時** | `List[Tuple[str, str]]` | 2名ずつの名前を格納したタプルのリスト。例: `[('社員A', '社員B'), ('社員C', '社員D'), ...]` |
| **失敗時** | `None` | 条件を満たす組み合わせが見つからなかったことを示す。 |

## 6\. 例外処理

  - `FileNotFoundError`: 指定されたCSVファイルが存在しない場合に発生。
  - `KeyError`: CSVファイルに必須カラム（`名前`, `グループ`, `チーム`）が存在しない場合に発生。
  - `ValueError`: 除外対象者を除いた後の、ペアリング対象人数が奇数の場合に発生。

## 7\. 使用例

```python
from typing import List, Tuple

# --- 関数の定義 (上記要件に基づき実装) ---
def generate_complete_pairing(
    employee_info_csv: str,
    team_info_csv: str,
    exclusion_list: List[str] = []
) -> List[Tuple[str, str]] | None:
    # ... 関数の実装 ...
    pass

# --- 関数の呼び出し ---
# ファイルパスと除外リストを指定
employee_csv_path = 'path/to/your/employee_data.csv'
team_csv_path = 'path/to/your/team_data.csv'
exclude_names = ['三留秋穂', '志田彩']

# 関数を実行してペアリング結果を取得
try:
    pairing_result = generate_complete_pairing(
        employee_info_csv=employee_csv_path,
        team_info_csv=team_csv_path,
        exclusion_list=exclude_names
    )

    # 結果を出力
    if pairing_result:
        print(f"ペアリングに成功しました ({len(pairing_result)}組):")
        for i, (p1, p2) in enumerate(pairing_result, 1):
            print(f"  ペア{i}: {p1}, {p2}")
    else:
        print("条件を満たすペアの組み合わせは見つかりませんでした。")

except (FileNotFoundError, KeyError, ValueError) as e:
    print(f"エラーが発生しました: {e}")

```